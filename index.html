<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lauti & Carol â€“ TraducciÃ³n</title>

<style>
body {
    margin: 0;
    background: #000;
    font-family: Arial, sans-serif;
    color: white;
}

#selector {
    position: fixed;
    inset: 0;
    background: #000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 30px;
    z-index: 10;
}

#selector button {
    font-size: 22px;
    padding: 15px 40px;
    cursor: pointer;
}

#app {
    display: none;
    height: 100vh;
}

.container {
    display: flex;
    height: 100%;
}

.user {
    width: 50%;
    position: relative;
}

video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.subtitle {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    font-size: 22px;
    padding: 0 20px;
    text-shadow: 2px 2px 8px black;
}

.label {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.6);
    padding: 6px 10px;
    font-size: 14px;
}
</style>
</head>

<body>

<!-- Selector -->
<div id="selector">
    <h1>ElegÃ­ tu perfil</h1>
    <button onclick="start('lauti')">Lauti ðŸ‡¦ðŸ‡· â†’ ðŸ‡§ðŸ‡·</button>
    <button onclick="start('carol')">Carol ðŸ‡§ðŸ‡· â†’ ðŸ‡¦ðŸ‡·</button>
</div>

<!-- App -->
<div id="app">
    <div class="container">
        <div class="user">
            <span class="label">Lauti</span>
            <video id="camLauti" autoplay muted playsinline></video>
            <div id="subLauti" class="subtitle"></div>
        </div>
        <div class="user">
            <span class="label">Carol</span>
            <video id="camCarol" autoplay muted playsinline></video>
            <div id="subCarol" class="subtitle"></div>
        </div>
    </div>
</div>

<script>
let profile = null;

// ---------- START ----------
async function start(p) {
    profile = p;
    document.getElementById("selector").style.display = "none";
    document.getElementById("app").style.display = "block";

    const stream = await navigator.mediaDevices.getUserMedia({
        video: true,
        audio: true
    });

    // misma cÃ¡mara para los dos (solo demo)
    camLauti.srcObject = stream;
    camCarol.srcObject = stream;

    startSpeech();
}

// ---------- SPEECH ----------
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SpeechRecognition();

rec.continuous = true;
rec.interimResults = false;

rec.onresult = e => {
    const text = e.results[e.results.length - 1][0].transcript.trim();

    if (profile === "lauti") {
        translate(text, "es", "pt", "subLauti");
    } else {
        translate(text, "pt", "es", "subCarol");
    }
};

rec.onend = () => rec.start();

// ---------- TRANSLATE ----------
async function translate(text, from, to, target) {
    const url =
        "https://translate.googleapis.com/translate_a/single" +
        `?client=gtx&sl=${from}&tl=${to}&dt=t&q=` +
        encodeURIComponent(text);

    try {
        const r = await fetch(url);
        const d = await r.json();

        let translated = "";
        d[0].forEach(t => translated += t[0]);

        document.getElementById(target).innerText = translated;
    } catch (e) {
        console.error(e);
    }
}

function startSpeech() {
    if (profile === "lauti") rec.lang = "es-AR";
    if (profile === "carol") rec.lang = "pt-BR";
    rec.start();
}
</script>

</body>
</html>
